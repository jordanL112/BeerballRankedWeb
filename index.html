<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Beerball Leaderboard</title>

<style>
  body {
    background:#0f0f0f;
    color:white;
    font-family:Arial, sans-serif;
    margin:20px;
  }

  nav {
    display:flex;
    justify-content:center;
    gap:15px;
    margin-bottom:20px;
  }

  /* Ensure all player names are bold */
  .name-cell, .team-cell, .clan-cell {
    font-weight: bold;
  }

  .nav-button {
    padding:10px 20px;
    background-color:#444;
    border:none;
    color:white;
    cursor:pointer;
  }

  .nav-button:hover { background-color:#666; }

  .section { display:none; }

  table {
    width:100%;
    border-collapse:collapse;
  }

  th, td {
    padding:10px;
    border-bottom:1px solid #333;
    text-align:center;
  }

  th {
    position:sticky;
    top:0;
    background:#000;
  }

  tr:hover { background:#222; }

  .rank-icon {
    width:50px;
    height:50px;
  }

  /* Optional: make flashing look smoother than MATLAB */
  .flash-smooth {
    transition: color 180ms linear;
    will-change: color;
  }

  /* Animation for fading the color */
  @keyframes fadeInOut {
    0% {
      color: white;
    }
    50% {
      color: rgb(0, 179, 255); /* Crimson Bright Blue */
    }
    100% {
      color: rgb(153, 128, 26); /* Crimson Dark Gold */
    }
  }
</style>
</head>

<body>

<h1>üç∫ Beerball Leaderboard</h1>

<nav>
  <button class="nav-button" onclick="showSection('leaderboard')">Leaderboard</button>
  <button class="nav-button" onclick="showSection('clans')">Clans</button>
  <button class="nav-button" onclick="showSection('playerCards')">Player Cards</button>
  <button class="nav-button" onclick="showSection('shop')">Points Shop</button>
</nav>

<div id="leaderboard" class="section">
  <h2>Leaderboard</h2>
  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Name</th>
        <th>Tier</th>
        <th>ELO</th>
        <th>Games</th>
        <th>W</th>
        <th>L</th>
        <th>Win %</th>
        <th>Team</th>
        <th>Clan</th>
      </tr>
    </thead>
    <tbody id="board"></tbody>
  </table>
</div>

<div id="clans" class="section">
  <h2>Clans</h2>
  <p>(Coming soon)</p>
</div>

<div id="playerCards" class="section">
  <h2>Player Cards</h2>
  <p>(Coming soon)</p>
</div>

<div id="shop" class="section">
  <h2>Points Shop</h2>
  <p>(Coming soon)</p>
</div>

<script>
// Add these helper functions for team and clan color
function findTeamColor(teamName, teams) {
  const team = teams.find(t => t.name === teamName);
  return team ? team.color : null;
}

function findClanColor(clanName, clans) {
  const clan = clans.find(c => c.name === clanName);
  return clan ? clan.color : null;
}

/* ------------------ SECTION SWITCH ------------------ */
function showSection(sectionId) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  const active = document.getElementById(sectionId);
  if (active) active.style.display = 'block';
}

function safeText(x) {
  if (Array.isArray(x)) return x.join(" ");
  if (x === null || x === undefined) return "";
  return String(x);
}

/* ------------------ SAFE NORMALIZERS ------------------ */
function normText(x) {
  if (Array.isArray(x)) return x.join(" ").trim();
  if (x === null || x === undefined) return "";
  return String(x).trim();
}

/* ------------------ ICONS ------------------ */
function tierToIcon(tier) {
  tier = normText(tier);   // <-- THIS LINE FIXES IT

  if (tier.startsWith("Crimson")) return "icons/crimson.png";
  if (tier.startsWith("Master")) return "icons/master.png";
  if (tier.startsWith("Diamond")) return "icons/diamond.png";
  if (tier.startsWith("Platinum")) return "icons/platinum.png";
  if (tier.startsWith("Gold")) return "icons/gold.png";
  if (tier.startsWith("Silver")) return "icons/silver.png";
  return "icons/bronze.png";
}

/* ------------------ TIER AND GROUP FLASHING ------------------ */
function tierPulseColor(tier, CrimsonFlip) {
  switch (tier) {
    case "Crimson":
      return "rgb(255,22,22)";
    case "Master":
      return "rgb(102,0,153)";
    case "Diamond I":
    case "Diamond II":
    case "Diamond III":
      return "rgb(0,51,153)";
    case "Silver I":
    case "Silver II":
    case "Silver III":
      return "rgb(191,191,191)";
    case "Bronze I":
    case "Bronze II":
    case "Bronze III":
      return "rgb(102,51,0)";
    default:
      return "white";
  }
}

function startTierFlash(el, tier) {
  el.classList.add("flash-smooth");

  let state = true;      // true -> base, false -> pulse (matching MATLAB toggle)
  let CrimsonFlip = 0;     // 0 -> white, 1 -> blue, 2 -> gold (for Crimson tier)

  setInterval(() => {
    if (state) {
      el.style.color = "white";  // Base state: White
      el.style.fontWeight = "bold"; // Ensure it's bold
    } else {
      el.style.fontWeight = "bold";  // Ensure it stays bold

      if (tier === "Crimson") {
        // Alternating logic for Crimson tier (white -> blue -> white -> gold)
        if (CrimsonFlip === 0) {
          el.style.color = "rgb(0,179,255)";  // Bright Blue
          CrimsonFlip = 1;
        } else if (CrimsonFlip === 1) {
          el.style.color = "white";  // Reset to White
          CrimsonFlip = 2;
        } else {
          el.style.color = "rgb(153,128,26)";  // Dark Gold
          CrimsonFlip = 0;
        }
      } else {
        // For other tiers (Master, Diamond, etc.), apply the regular flashing effect
        el.style.color = tierPulseColor(tier, false);
      }
    }
    state = !state;
  }, 600); // Flash the color every 600ms
}


/* ------------------ TIER AND GROUP FLASHING ------------------ */
function startFlash(el, color1, color2) {
  el.classList.add("flash-smooth");

  let state = true;      // true -> base, false -> pulse
  let flip = false;      // for alternating pulse colors

  setInterval(() => {
    if (state) {
      el.style.color = color1;  // Base color
      el.style.fontWeight = "bold"; // Keep it bold
    } else {
      el.style.color = color2;  // Flashing color
      el.style.fontWeight = "bold"; // Keep it bold
    }
    state = !state;
  }, 700);  // Flash the color every 700ms
}

/* ------------------ RENDER ------------------ */
fetch("leaderboard.json")
  .then(r => r.json())
  .then(data => {
    const players = data.players || [];
    const teams = data.teams || [];
    const clans = data.clans || [];
    const tbody = document.getElementById("board");
    if (!tbody) return;

    players.forEach(p => {
      const name = normText(p.name);
      const team = normText(p.team);
      const clan = normText(p.clan);

      const winPct = (p.games && p.games > 0)
        ? ((p.wins / p.games) * 100).toFixed(1) + "%"
        : "0.0%";

      // Build row
      const row = document.createElement("tr");

      // NAME span (so we can flash it)
      const nameSpan = document.createElement("span");
      nameSpan.textContent = name;
      nameSpan.style.color = "white"; // Default to white

      // TEAM span
      const teamSpan = document.createElement("span");
      teamSpan.textContent = team;
      teamSpan.style.fontWeight = "bold";  // Keep team names bold

      // Apply flashing effect to team if teamColor exists and isn't empty
      if (p.teamColor && p.teamColor !== "" && p.teamColor !== "rgb(0, 0, 0)") {  // Only flash if teamColor is valid
        startFlash(teamSpan, "white", p.teamColor);  // Apply flashing effect if color exists
      } else {
        teamSpan.style.color = "white";  // Default to white if no valid teamColor
      }

      // CLAN span
      const clanSpan = document.createElement("span");
      clanSpan.textContent = clan;
      clanSpan.style.fontWeight = "bold";  // Keep clan names bold

      // Apply flashing effect to clan if clanColor exists
      if (p.clanColor) {
        startFlash(clanSpan, "white", p.clanColor);  // Apply flashing effect if color exists
      } else {
        clanSpan.style.color = "white";  // Default to white if no clanColor
      }

      row.innerHTML = `
        <td class="rank-cell">
          <span>${p.rank}</span>
          <img class="rank-icon" src="${tierToIcon(normText(p.tier))}" alt="">
        </td>
        <td class="name-cell"></td>
        <td>${normText(p.tier)}</td>
        <td>${p.elo}</td>
        <td>${p.games}</td>
        <td>${p.wins}</td>
        <td>${p.losses}</td>
        <td>${winPct}</td>
        <td class="team-cell"></td>
        <td class="clan-cell"></td>
      `;

      row.querySelector(".name-cell").appendChild(nameSpan);
      row.querySelector(".team-cell").appendChild(teamSpan);
      row.querySelector(".clan-cell").appendChild(clanSpan);

      tbody.appendChild(row);

      // ---- Apply flashing rules ----
      // Player name flashes ONLY if purchased (p.hasFlash === true)
      if (p.hasFlash === true) {
        startFlash(nameSpan, "white", tierPulseColor(p.tier, false));
      }
    });
  })
  .catch(err => {
    console.error("Error loading leaderboard.json:", err);
  });

// Default view
showSection("leaderboard");


</script>




</body>
</html>
